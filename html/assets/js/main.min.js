function postJson(t,e,a){"function"==typeof e&&(a=e,e={});var o=a||parseAjax;$.ajax({method:"POST",url:t,beforeSend:function(t,e){"POST"===e.type&&"undefined"!=typeof Cookies&&(e=Cookies.get("XSRF-TOKEN"))&&t.setRequestHeader("X-CSRF-TOKEN",e)},data:e,dataType:"json",success:o,error:function(t){t.responseJSON?o(t.responseJSON):o({code:t.status,message:t.statusText})}})}function ajaxForm(t,e,a){postJson(t,e,function(t){(a||parseAjax)(t)})}function formData(t){var e=[];return t.find("input,textarea,select").each(function(){this.type&&0<=["radio","checkbox"].indexOf(this.type)&&!this.checked||e.push(encodeURIComponent(this.name)+"="+encodeURIComponent($(this).val().toString()))}),e.join("&")}function parseAjax(t){if(302===t.code||401===t.code&&t.url)window.location.href=t.url;else{if(200!==t.code)return"object"==typeof t.message?void $.each(t.message,function(a,t){$.each(t,function(t,e){Dialog.tip(a+(e||"操作执行失败！"))})}):void Dialog.tip(t.message||"操作执行失败！");Dialog.tip(t.message||"操作执行完成！"),t.data&&t.data.refresh&&setTimeout(function(){t.data.no_jax||"function"!=typeof parseAjaxUri?window.location.reload():parseAjaxUri(window.location.href)},500),t.data&&t.data.url&&setTimeout(function(){-1===t.data.url?history.go(-1):t.data.no_jax||"function"!=typeof parseAjaxUri?window.location.href=t.data.url:parseAjaxUri(t.data.url)},500)}}var toFloat=function(t){return(t=t&&t.toString().replace(",","").match(/[\d\.]+/))?parseFloat(t):0},toInt=function(t){return(t=t&&t.toString().replace(",","").match(/[\d]+/))?parseInt(t,10):0},strFormat=function(t){for(var a=[],e=1;e<arguments.length;e++)a[e-1]=arguments[e];return t.replace(/\{(\d+)\}/g,function(t,e){return a[e]})},file_upload;$(function(){"function"==typeof Upload&&"string"==typeof UPLOAD_URI&&(file_upload=new Upload(null,{url:UPLOAD_URI,name:"upfile",template:"{url}",onbefore:function(t,e){return e.closest(".file-input").addClass("file-uploading"),t},onafter:function(t,e){return"SUCCESS"==t.state?e.prev("input").val(t.url):302===t.code?location.href=t.url:Dialog.tip(null!=(t=t.state)?t:"上传失败"),e.closest(".file-input").removeClass("file-uploading"),!1},onerror:function(t,e){Dialog.tip(413==t.status?"文件太大，无法上传":"上传失败"),e.closest(".file-input").removeClass("file-uploading")}}));var doc=$(document).on("click","a[data-type=refresh]",function(){window.location.reload()}).on("click","a[data-type=ajax]",function(e){e.preventDefault();var $this=$(this),successTip=$this.data("success")||"提交成功！",errorTip=$this.data("error")||"提交失败！",callback=$this.data("callback"),loading=Dialog.loading();postJson($this.attr("href"),function(data){loading.close(),200!=data.code||data.msg||(data.msg=successTip),200==data.code&&callback&&eval(callback+"($this, data);"),parseAjax(data)})}).on("submit","form[data-type=ajax]",function(){var e=$(this),a=Dialog.loading();return ajaxForm(e.attr("action"),e.serialize(),function(t){a.close(),parseAjax(t),400===t.code&&"object"==typeof t.message&&e.trigger("form:invalid",t.message)}),!1}).on("click","a[data-type=post]",function(t){t.preventDefault();t=$('<form action="'+$(this).attr("href")+'" method="post"></form');$(document.body).append(t),t.trigger("submit")}).on("click",".file-input [data-type=upload]",function(){var t,e=$(this);e.closest(".file-input").hasClass("file-uploading")?Dialog.tip("文件正在上传中。。。"):(t=e.data("allow")||"",(file_upload.options.filter=t).indexOf("image")<0&&(file_upload.options.url=UPLOAD_URI.replace("uploadimage","uploadfile")),file_upload.start(e))}).on("click",".file-input [data-type=datetime]",function(){var t,e,a=$(this);"function"==typeof DateTimer&&(t=a.prev("input"),(e=a.data("picker"))||((e=new DateTimer(a,{format:a.data("format")})).init(t.val()),a.data("picker",e)),e.on("done",function(){t.val(e.val())}),e.open())}).on("click",".file-input [data-type=preview]",function(){var a,t=$(this).closest(".file-input"),e=0<=(t.find("[data-type=upload]").data("allow")||"").indexOf("image"),t=t.find("input").val();t?e?((a=new Image).src=t,a.onload=function(){var t,e=Dialog.box({title:"预览",content:""});(a.width>window.innerWidth||a.height>window.innerHeight)&&(t=Math.min((window.innerWidth-100)/a.width,(window.innerHeight-100)/a.height),a.style.width=t*a.width+"px",a.style.height=t*a.height+"px"),e.find(".dialog-body").append(a),e.showCenter()}):window.open(t,"_blank"):Dialog.tip("请上传".concat(e?"图片":"文件","！"))}).on("click",".tab-box .tab-header .tab-item",function(){var t=$(this),e=t.index();toggleTab(t,t.closest(".tab-box").find(".tab-body .tab-item").eq(e),e)}).on("tab:toggle",".tab-box .tab-body .tab-item",function(){var t,e=$(this);e.hasClass("active")||(t=e.index(),toggleTab(e.closest(".tab-box").find(".tab-header .tab-item").eq(t),e,t))}).on("click",".dropdown .dropdown-toggle",function(t){t.preventDefault(),$(this).closest(".dropdown").toggleClass("--with-open")}).on("click",".--with-open",function(t){t.stopPropagation();t=$(t.target).parents(".--with-open").add(t.target);$(".--with-open").not(t).removeClass("--with-open")}),toggleTab=function(t,e,a){t.addClass("active").siblings().removeClass("active"),e.addClass("active").siblings().removeClass("active"),e.trigger("tab:actived",a)}});